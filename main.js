!function(e){window.Card=function(){function r(){e("#artwork, .view-content").addClass("side"),t.addClass("active")}function a(){return i.removeClass("microgrid normal world"),i.addClass(c.type),c.title&&t.find(".card-title").text(c.title),c.description&&t.find(".card-description").text(c.description),c.quote&&t.find(".card-quote").text(c.quote),_.includes(c.detail,".mov")?(d.attr("src",c.detail),d.removeClass("hidden"),o.addClass("hidden"),!0):(o.attr("src",c.detail),o.removeClass("hidden"),d.addClass("hidden"),!1)}var n=this,t=null,i=null,c=null,d=null,o=null;n.update=a,n.in=r,n.out=function(){e("#artwork, .view-content").removeClass("side"),t.removeClass("active"),APP.currentCard=null},n.set=function(e){c=e},n.show=function(){null!=APP.currentCard?TweenMax.to(i,.5,{opacity:0,onComplete:function(){a()?(e(".card-loader").removeClass("hidden"),d.on("canplay",function(){TweenMax.to(i,.5,{opacity:1}),e(".card-loader").addClass("hidden")})):TweenMax.to(i,.5,{opacity:1})}}):(a(),r())},t=e(".card-container"),i=e(".card-content"),d=i.find(".card-detail-video"),o=i.find(".card-detail-picture")}}(window.jQuery),function(e){function r(){APP.cards.forEach(function(e){c(e)}),APP.view_cards=_.filter(APP.cards,function(e){return"world"!=e.type}),e(".view-container").on("click",function(r){var n=e(r.target);n.hasClass("marker")||n.closest(".marker").length||APP.card&&null!=APP.currentCard&&a()}),e(".card-nav-next").click(function(){APP.view_cards[APP.currentCard];var e=APP.view_cards[APP.currentCard+1];APP.currentCard+1>=APP.view_cards.length&&(e=APP.view_cards[0]),t(e)}),e("#switch-village").click(function(){n("village")}),e("#switch-world").click(function(){n("world")}),"world"!=APP.currentView&&e(".map-legend").hide(),d()}function a(){APP.card.out(),i(),APP.currentCard=null}function n(r){r!=APP.currentView&&("village"==r?(APP.view_cards=_.filter(APP.cards,function(e){return"world"!=e.type}),e(".village-view").addClass("active"),e(".world-view").removeClass("active"),e("#switch-cursor, body, #active-icons").removeClass("world"),APP.currentView="village",TweenMax.to(e(".map-legend"),.5,{opacity:0,display:"none"})):(APP.view_cards=_.filter(APP.cards,function(e){return"world"==e.type}),e(".world-view").addClass("active"),e(".village-view").removeClass("active"),e("#switch-cursor, body, #active-icons").addClass("world"),APP.currentView="world",TweenMax.to(e(".map-legend"),.5,{opacity:1,display:"block"})),null!=APP.currentCard&&a())}function t(r){APP.card.set(r),APP.card.show(),APP.currentCard=APP.view_cards.indexOf(r);var a=e("#"+r.key);i(),a.addClass("active")}function i(){e(".marker.active").removeClass("active")}function c(r){var a=e("#"+r.key);a.addClass("marker"),"microgrid"==r.type&&a.addClass("microgrid"),setTimeout(function(){a.addClass("animation")},1500*Math.random()),a.click(function(e){APP.view_cards.indexOf(r)!=APP.currentCard&&t(r)})}function d(){e("#map-legend-values circle").click(function(r){if(!APP.hl){var a=e(r.target).attr("fill");TweenMax.to(e(r.target),.5,{scale:1.2,transformOrigin:"center center",repeat:3,yoyo:!0}),o(a)}})}function o(r){if(!APP.hl){APP.hl=!0;var a=e("#countries").find("path[fill!='"+r+"'], polygon[fill!='"+r+"'], polyline[fill!='"+r+"']");TweenMax.to(a,1,{fill:"#fff",stroke:"#fff",strokeOpacity:.2,opacity:.6,repeat:1,yoyo:!0,onComplete:function(){APP.hl=!1}})}}window.APP={},APP.cards=[],APP.view_cards=[],APP.card=new Card,APP.currentView="village",e(function(){e.getJSON("assets/data/cards.json",function(e){APP.cards=e.cards,r()})})}(window.jQuery);